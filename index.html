<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>صحتي — استبيان</title>
  <style>
    /* --- Base --- */
    :root{
      --primary:#2c5aa0;
      --accent:#20b2aa;
      --bg:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
      --card:#ffffff;
      --muted:#6b7280;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: "Segoe UI", Tahoma, system-ui, "Cairo", sans-serif;
      background:var(--bg);
      color:#111827;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      padding:30px 16px;
    }

    .wrap{
      max-width:1100px;
      margin:0 auto;
      background:transparent;
    }

    header{
      background:rgba(255,255,255,0.95);
      border-radius:12px;
      padding:14px 18px;
      box-shadow:0 6px 30px rgba(0,0,0,0.08);
      margin-bottom:18px;
    }
    header .brand{display:flex;gap:12px;align-items:center}
    header .brand .logo{width:48px;height:48px;border-radius:10px;background:linear-gradient(45deg,var(--accent),var(--primary));display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;font-size:20px}
    header h1{font-size:20px;color:var(--primary);margin:0}

    .grid{
      display:grid;
      grid-template-columns: 1fr 420px;
      gap:20px;
    }
    @media(max-width:980px){ .grid{ grid-template-columns:1fr } }

    /* left content */
    .panel{
      background:var(--card);
      border-radius:14px;
      padding:26px;
      box-shadow:0 18px 50px rgba(0,0,0,0.12);
      overflow:hidden;
    }
    .hero h2{margin:0 0 8px 0;color:#fff;font-size:28px}
    .hero p{color:#fff;opacity:0.95;margin:0 0 8px 0}

    .section-title{color:var(--primary);font-size:22px;margin-bottom:12px}

    /* form */
    form{display:block}
    .survey-form{
      background:linear-gradient(145deg,#ffffff,#f5f7fb);
      padding:20px;border-radius:12px;border:1px solid #e6e9ef;
    }
    .form-row{display:flex;gap:12px;margin-bottom:12px}
    .form-row.column{flex-direction:column}
    .form-group{flex:1}
    label{display:block;font-weight:600;color:var(--primary);margin-bottom:6px}
    input[type="text"], input[type="email"], input[type="tel"], select, textarea{
      width:100%; padding:10px 12px; border-radius:10px; border:1px solid #e4e7ee;
      font-size:14px; background:#fff;
    }
    input:focus, select:focus, textarea:focus{outline:none;border-color:var(--accent); box-shadow:0 6px 20px rgba(32,178,170,0.08)}
    textarea{min-height:90px; resize:vertical}

    .checkbox-group{
      display:grid;
      grid-template-columns: repeat(auto-fit,minmax(180px,1fr));
      gap:8px;
    }
    .checkbox-item{
      display:flex; gap:8px; align-items:center; padding:8px; background:#f8fafc; border-radius:8px; border:1px solid #eef2f7;
    }
    .checkbox-item input{transform:scale(1.05)}

    .submit-row{margin-top:14px}
    .submit-btn{
      width:100%; padding:12px 16px; background:linear-gradient(45deg,var(--accent),var(--primary));
      color:#fff; border:none; border-radius:12px; font-weight:700; font-size:16px; cursor:pointer;
      box-shadow:0 12px 30px rgba(44,90,160,0.16);
    }
    .submit-btn[disabled]{opacity:0.65; cursor:not-allowed; transform:none}

    .success-message{
      display:none;
      margin-top:12px;
      padding:14px;
      border-radius:10px;
      background:linear-gradient(45deg,#28a745,#20c997);
      color:white; font-weight:700; text-align:center;
      box-shadow:0 12px 30px rgba(32,167,69,0.18);
    }

    .right-panel{
      display:flex; flex-direction:column; gap:14px;
    }
    .info-card{background:var(--card); padding:18px; border-radius:12px; border:1px solid #eef2f7}
    .muted{color:var(--muted); font-size:14px}

    .field-error{color:#b91c1c;font-size:13px;margin-top:6px;display:none}

    /* small text */
    .small{font-size:13px;color:var(--muted)}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo">+</div>
        <div>
          <h1>صحتي — استبيان المستخدمين</h1>
          <div class="small">ساعدنا نبني التطبيق المناسب لك — تعبئة سريعة وآمنة</div>
        </div>
      </div>
    </header>

    <div class="grid">
      <!-- LEFT: FORM -->
      <div class="panel">
        <div style="background:linear-gradient(135deg,#667eea,#764ba2);padding:18px;border-radius:10px;color:#fff;margin-bottom:16px">
          <h2 style="margin:0">ملفك الطبي الذكي في جيبك</h2>
          <p style="margin:6px 0 0">شاركنا رأيك عشان نطوّر أفضل نسخة تخدمك.</p>
        </div>

        <div class="section-title">ساعدنا في بناء التطبيق</div>

        <form id="surveyForm" class="survey-form" novalidate>
          <!-- Email / WhatsApp -->
          <div class="form-row">
            <div class="form-group">
              <label for="email">البريد الإلكتروني *</label>
              <input id="email" name="email" type="email" placeholder="example@mail.com" required>
              <div id="emailError" class="field-error">أدخل بريدًا إلكترونيًا صالحًا</div>
            </div>
            <div class="form-group">
              <label for="phone">رقم الواتساب *</label>
              <input id="phone" name="whatsapp" type="tel" placeholder="01xxxxxxxxx" required>
              <div id="phoneError" class="field-error">أدخل رقم واتساب صحيح</div>
            </div>
          </div>

          <!-- Age / City -->
          <div class="form-row">
            <div class="form-group">
              <label for="age">العمر *</label>
              <select id="age" name="ageGroup" required>
                <option value="">اختر العمر</option>
                <option value="18-25">18-25</option>
                <option value="26-35">26-35</option>
                <option value="36-45">36-45</option>
                <option value="46-55">46-55</option>
                <option value="56+">56+</option>
              </select>
              <div id="ageError" class="field-error">اختر الفئة العمرية</div>
            </div>
            <div class="form-group">
              <label for="city">المدينة *</label>
              <input id="city" name="city" type="text" placeholder="مثال: القاهرة" required>
              <div id="cityError" class="field-error">أدخل اسم المدينة</div>
            </div>
          </div>

          <!-- Problems (checkboxes) -->
          <div style="margin-bottom:12px">
            <label>ما هي أكبر المشاكل التي تواجهها في إدارة صحتك؟ (اختر واحد أو أكثر)</label>
            <div class="checkbox-group" style="margin-top:8px">
              <label class="checkbox-item"><input type="checkbox" name="problemsCheckbox" value="إدخال البيانات يدوياً من التقارير"> إدخال البيانات يدوياً من التقارير</label>
              <label class="checkbox-item"><input type="checkbox" name="problemsCheckbox" value="فقدان الملفات الطبية"> فقدان الملفات الطبية</label>
              <label class="checkbox-item"><input type="checkbox" name="problemsCheckbox" value="نسيان مواعيد الأدوية"> نسيان مواعيد الأدوية</label>
              <label class="checkbox-item"><input type="checkbox" name="problemsCheckbox" value="العثور على الأطباء"> العثور على الأطباء</label>
              <label class="checkbox-item"><input type="checkbox" name="problemsCheckbox" value="تنظيم المواعيد"> تنظيم المواعيد</label>
              <label class="checkbox-item"><input type="checkbox" name="problemsCheckbox" value="مشاركة المعلومات مع الأطباء"> مشاركة المعلومات مع الأطباء</label>
              <label class="checkbox-item"><input type="checkbox" name="problemsCheckbox" value="متابعة الحالة الصحية"> متابعة الحالة الصحية</label>
            </div>
            <div id="problemsError" class="field-error">اختر مشكلة واحدة على الأقل</div>
          </div>

          <!-- Usage frequency / Price -->
          <div class="form-row">
            <div class="form-group">
              <label for="usage-frequency">كم مرة تزور الطبيب شهرياً؟</label>
              <select id="usage-frequency" name="visitFrequency">
                <option value="">اختر التكرار</option>
                <option value="نادراً (مرة أو أقل)">نادراً (مرة أو أقل)</option>
                <option value="أحياناً (2-3 مرات)">أحياناً (2-3 مرات)</option>
                <option value="غالباً (4-6 مرات)">غالباً (4-6 مرات)</option>
                <option value="كثيراً (أكثر من 6 مرات)">كثيراً (أكثر من 6 مرات)</option>
              </select>
              <div id="visitError" class="field-error">اختر تكرار الزيارة</div>
            </div>
            <div class="form-group">
              <label for="payment-willingness">كم ستكون مستعداً لدفع شهرياً مقابل هذا التطبيق؟</label>
              <select id="payment-willingness" name="priceReadiness">
                <option value="">اختر السعر</option>
                <option value="مجاني فقط">مجاني فقط</option>
                <option value="1-20 جنيه">1-20 جنيه</option>
                <option value="21-50 جنيه">21-50 جنيه</option>
                <option value="51-100 جنيه">51-100 جنيه</option>
                <option value="أكثر من 100 جنيه">أكثر من 100 جنيه</option>
              </select>
              <div id="priceError" class="field-error">اختر شريحة السعر</div>
            </div>
          </div>

          <!-- Suggestions -->
          <div class="form-row column">
            <div class="form-group">
              <label for="suggestions">اقتراحات أو ميزات إضافية تود رؤيتها (الحد الأقصى 1000 حرف)</label>
              <textarea id="suggestions" name="suggestions" maxlength="1000" placeholder="اكتب اقتراحك..."></textarea>
              <div id="suggestionsError" class="field-error">الاقتراح طويل جداً (أقصى 1000 حرف)</div>
            </div>
          </div>

          <div class="submit-row">
            <button id="submitBtn" class="submit-btn" type="submit">إرسال الاستبيان</button>
            <div id="successMessage" class="success-message">🎉 شكراً! تم إرسال استجابتك بنجاح.</div>
          </div>
        </form>
      </div>

      <!-- RIGHT: info -->
      <div class="right-panel">
        <div class="info-card">
          <h3 style="margin:0 0 6px 0;color:var(--primary)">معلومات مهمة</h3>
          <p class="muted" style="margin:0">
            سيتم إرسال البيانات إلى السيرفر المحلي:
            <code>http://localhost:8086/api/leads</code>
            <br><br>
            الحقول المرسلة (JSON):
            <ul style="padding-left:18px;margin:8px 0 0 0">
              <li><b>email</b> — String (مطلوب، صيغة email)</li>
              <li><b>whatsapp</b> — String (مطلوب)</li>
              <li><b>ageGroup</b> — String (مطلوب)</li>
              <li><b>city</b> — String (مطلوب)</li>
              <li><b>problems</b> — String (مطلوب) — قيم مفصولة بفاصلة</li>
              <li><b>visitFrequency</b> — String (مطلوب)</li>
              <li><b>priceReadiness</b> — String (مطلوب)</li>
              <li><b>suggestions</b> — String (max 1000)</li>
            </ul>
          </p>
        </div>

        <div class="info-card">
          <h4 style="margin:0 0 8px 0">نصائح سريعة</h4>
          <div class="small">
            • لو ظهر خطأ CORS: فعل إعدادات CORS في Spring Boot أو اضف @CrossOrigin على الكونترولر.<br>
            • صفحة تعمل عبر HTTPS لا يمكنها تستدعي HTTP محلي — استخدم نفس البروتوكول أو إعداد SSL في dev.
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    (function(){
      const form = document.getElementById('surveyForm');
      const submitBtn = document.getElementById('submitBtn');
      const successMessage = document.getElementById('successMessage');

      // Error elements
      const emailError = document.getElementById('emailError');
      const phoneError = document.getElementById('phoneError');
      const ageError = document.getElementById('ageError');
      const cityError = document.getElementById('cityError');
      const problemsError = document.getElementById('problemsError');
      const visitError = document.getElementById('visitError');
      const priceError = document.getElementById('priceError');
      const suggestionsError = document.getElementById('suggestionsError');

      function hideAllErrors(){
        [emailError, phoneError, ageError, cityError, problemsError, visitError, priceError, suggestionsError].forEach(el=>{
          if(el) el.style.display = 'none';
        });
      }

      function showError(el, msg){
        if(!el) return;
        el.textContent = msg || el.textContent;
        el.style.display = 'block';
      }

      form.addEventListener('submit', async (e)=>{
        e.preventDefault();
        hideAllErrors();

        // collect values
        const email = document.getElementById('email').value.trim();
        const whatsapp = document.getElementById('phone').value.trim();
        const ageGroup = document.getElementById('age').value;
        const city = document.getElementById('city').value.trim();
        const problemsChecked = Array.from(document.querySelectorAll('input[name="problemsCheckbox"]:checked')).map(i=>i.value);
        const visitFrequency = document.getElementById('usage-frequency').value;
        const priceReadiness = document.getElementById('payment-willingness').value;
        const suggestions = document.getElementById('suggestions').value.trim();

        // front-end validation (mirror backend)
        let valid = true;
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

        if(!email){ showError(emailError, 'البريد الإلكتروني مطلوب'); valid=false; }
        else if(!emailRegex.test(email)){ showError(emailError, 'أدخل بريدًا إلكترونيًا صالحًا'); valid=false; }

        if(!whatsapp){ showError(phoneError, 'رقم الواتساب مطلوب'); valid=false; }

        if(!ageGroup){ showError(ageError, 'اختر الفئة العمرية'); valid=false; }

        if(!city){ showError(cityError, 'المدينة مطلوبة'); valid=false; }

        if(problemsChecked.length === 0){ showError(problemsError, 'اختر مشكلة واحدة على الأقل'); valid=false; }

        if(!visitFrequency){ showError(visitError, 'اختر تكرار زيارة الطبيب'); valid=false; }

        if(!priceReadiness){ showError(priceError, 'اختر مدى استعدادك للدفع'); valid=false; }

        if(suggestions.length > 1000){ showError(suggestionsError, 'الاقتراحات يجب ألا تزيد عن 1000 حرف'); valid=false; }

        if(!valid) return;

        // prepare payload (backend expects problems as String)
        const payload = {
          email: email,
          whatsapp: whatsapp,
          ageGroup: ageGroup,
          city: city,
          problems: problemsChecked.join(', '),
          visitFrequency: visitFrequency,
          priceReadiness: priceReadiness,
          suggestions: suggestions
        };

        // disable button while sending
        submitBtn.disabled = true;
        submitBtn.textContent = 'جاري الإرسال...';

        try {
          const res = await fetch('http://localhost:8086/api/leads', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          });

          if(res.ok){
            successMessage.style.display = 'block';
            form.reset();
            // auto-hide
            setTimeout(()=> successMessage.style.display='none', 6000);
          } else {
            // try to parse error body
            let text = await res.text();
            try{
              const j = JSON.parse(text);
              text = j.message || JSON.stringify(j);
            }catch(e){}
            alert('خطأ من السيرفر: ' + (text || res.statusText));
          }
        } catch(err){
          console.error(err);
          alert('فشل الاتصال بالسيرفر. تأكد أن backend شغّال وأن إعدادات CORS صحيحة.');
        } finally {
          submitBtn.disabled = false;
          submitBtn.textContent = 'إرسال الاستبيان';
        }
      });
    })();
  </script>
</body>
</html>
